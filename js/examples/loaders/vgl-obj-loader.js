!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("three"),require("three")):"function"==typeof define&&define.amd?define(["three","three"],e):((t="undefined"!=typeof globalThis?globalThis:t||self).VueGL=t.VueGL||{},t.VueGL.VglObjLoader=e(t.THREE,t.THREE))}(this,(function(t,e){"use strict";var i=function(){var e=/^[og]\s*(.+)?/,i=/^mtllib /,r=/^usemtl /,n=/^usemap /,s=new t.Vector3,o=new t.Vector3,a=new t.Vector3,l=new t.Vector3,c=new t.Vector3;function u(){var t={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(t,e){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=t,void(this.object.fromDeclaration=!1!==e);var i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:!1!==e,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(t,e){var i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);var r={index:this.materials.length,name:t||"",mtllib:Array.isArray(e)&&e.length>0?e[e.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(t){var e={index:"number"==typeof t?t:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return e.clone=this.clone.bind(e),e}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(t){var e=this.currentMaterial();if(e&&-1===e.groupEnd&&(e.groupEnd=this.geometry.vertices.length/3,e.groupCount=e.groupEnd-e.groupStart,e.inherited=!1),t&&this.materials.length>1)for(var i=this.materials.length-1;i>=0;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return t&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),e}},i&&i.name&&"function"==typeof i.clone){var r=i.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(t,e){var i=parseInt(t,10);return 3*(i>=0?i-1:i+e/3)},parseNormalIndex:function(t,e){var i=parseInt(t,10);return 3*(i>=0?i-1:i+e/3)},parseUVIndex:function(t,e){var i=parseInt(t,10);return 2*(i>=0?i-1:i+e/2)},addVertex:function(t,e,i){var r=this.vertices,n=this.object.geometry.vertices;n.push(r[t+0],r[t+1],r[t+2]),n.push(r[e+0],r[e+1],r[e+2]),n.push(r[i+0],r[i+1],r[i+2])},addVertexPoint:function(t){var e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addVertexLine:function(t){var e=this.vertices;this.object.geometry.vertices.push(e[t+0],e[t+1],e[t+2])},addNormal:function(t,e,i){var r=this.normals,n=this.object.geometry.normals;n.push(r[t+0],r[t+1],r[t+2]),n.push(r[e+0],r[e+1],r[e+2]),n.push(r[i+0],r[i+1],r[i+2])},addFaceNormal:function(t,e,i){var r=this.vertices,n=this.object.geometry.normals;s.fromArray(r,t),o.fromArray(r,e),a.fromArray(r,i),c.subVectors(a,o),l.subVectors(s,o),c.cross(l),c.normalize(),n.push(c.x,c.y,c.z),n.push(c.x,c.y,c.z),n.push(c.x,c.y,c.z)},addColor:function(t,e,i){var r=this.colors,n=this.object.geometry.colors;void 0!==r[t]&&n.push(r[t+0],r[t+1],r[t+2]),void 0!==r[e]&&n.push(r[e+0],r[e+1],r[e+2]),void 0!==r[i]&&n.push(r[i+0],r[i+1],r[i+2])},addUV:function(t,e,i){var r=this.uvs,n=this.object.geometry.uvs;n.push(r[t+0],r[t+1]),n.push(r[e+0],r[e+1]),n.push(r[i+0],r[i+1])},addDefaultUV:function(){var t=this.object.geometry.uvs;t.push(0,0),t.push(0,0),t.push(0,0)},addUVLine:function(t){var e=this.uvs;this.object.geometry.uvs.push(e[t+0],e[t+1])},addFace:function(t,e,i,r,n,s,o,a,l){var c=this.vertices.length,u=this.parseVertexIndex(t,c),h=this.parseVertexIndex(e,c),f=this.parseVertexIndex(i,c);if(this.addVertex(u,h,f),this.addColor(u,h,f),void 0!==o&&""!==o){var d=this.normals.length;u=this.parseNormalIndex(o,d),h=this.parseNormalIndex(a,d),f=this.parseNormalIndex(l,d),this.addNormal(u,h,f)}else this.addFaceNormal(u,h,f);if(void 0!==r&&""!==r){var p=this.uvs.length;u=this.parseUVIndex(r,p),h=this.parseUVIndex(n,p),f=this.parseUVIndex(s,p),this.addUV(u,h,f),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(t){this.object.geometry.type="Points";for(var e=this.vertices.length,i=0,r=t.length;i<r;i++){var n=this.parseVertexIndex(t[i],e);this.addVertexPoint(n),this.addColor(n)}},addLineGeometry:function(t,e){this.object.geometry.type="Line";for(var i=this.vertices.length,r=this.uvs.length,n=0,s=t.length;n<s;n++)this.addVertexLine(this.parseVertexIndex(t[n],i));var o=0;for(s=e.length;o<s;o++)this.addUVLine(this.parseUVIndex(e[o],r))}};return t.startObject("",!1),t}function h(e){t.Loader.call(this,e),this.materials=null}return h.prototype=Object.assign(Object.create(t.Loader.prototype),{constructor:h,load:function(e,i,r,n){var s=this,o=new t.FileLoader(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(t){try{i(s.parse(t))}catch(t){n?n(t):console.error(t),s.manager.itemError(e)}}),r,n)},setMaterials:function(t){return this.materials=t,this},parse:function(s){var o=new u;-1!==s.indexOf("\r\n")&&(s=s.replace(/\r\n/g,"\n")),-1!==s.indexOf("\\\n")&&(s=s.replace(/\\\n/g,""));for(var a=s.split("\n"),l="",c="",h=[],f="function"==typeof"".trimLeft,d=0,p=a.length;d<p;d++)if(l=a[d],0!==(l=f?l.trimLeft():l.trim()).length&&"#"!==(c=l.charAt(0)))if("v"===c){var m=l.split(/\s+/);switch(m[0]){case"v":o.vertices.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3])),m.length>=7?o.colors.push(parseFloat(m[4]),parseFloat(m[5]),parseFloat(m[6])):o.colors.push(void 0,void 0,void 0);break;case"vn":o.normals.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]));break;case"vt":o.uvs.push(parseFloat(m[1]),parseFloat(m[2]))}}else if("f"===c){for(var v=l.substr(1).trim().split(/\s+/),b=[],g=0,y=v.length;g<y;g++){var j=v[g];if(j.length>0){var w=j.split("/");b.push(w)}}var x=b[0];for(g=1,y=b.length-1;g<y;g++){var A=b[g],V=b[g+1];o.addFace(x[0],A[0],V[0],x[1],A[1],V[1],x[2],A[2],V[2])}}else if("l"===c){var O=l.substring(1).trim().split(" "),L=[],S=[];if(-1===l.indexOf("/"))L=O;else for(var F=0,I=O.length;F<I;F++){var E=O[F].split("/");""!==E[0]&&L.push(E[0]),""!==E[1]&&S.push(E[1])}o.addLineGeometry(L,S)}else if("p"===c){var M=l.substr(1).trim().split(" ");o.addPointGeometry(M)}else if(null!==(h=e.exec(l))){var U=(" "+h[0].substr(1).trim()).substr(1);o.startObject(U)}else if(r.test(l))o.object.startMaterial(l.substring(7).trim(),o.materialLibraries);else if(i.test(l))o.materialLibraries.push(l.substring(7).trim());else if(n.test(l))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if("s"===c){if((h=l.split(" ")).length>1){var z=h[1].trim().toLowerCase();o.object.smooth="0"!==z&&"off"!==z}else o.object.smooth=!0;(H=o.object.currentMaterial())&&(H.smooth=o.object.smooth)}else{if("\0"===l)continue;console.warn('THREE.OBJLoader: Unexpected line: "'+l+'"')}o.finalize();var N=new t.Group;if(N.materialLibraries=[].concat(o.materialLibraries),!0===!(1===o.objects.length&&0===o.objects[0].geometry.vertices.length))for(d=0,p=o.objects.length;d<p;d++){var P=o.objects[d],B=P.geometry,C=P.materials,G="Line"===B.type,_="Points"===B.type,R=!1;if(0!==B.vertices.length){(X=new t.BufferGeometry).setAttribute("position",new t.Float32BufferAttribute(B.vertices,3)),B.normals.length>0&&X.setAttribute("normal",new t.Float32BufferAttribute(B.normals,3)),B.colors.length>0&&(R=!0,X.setAttribute("color",new t.Float32BufferAttribute(B.colors,3))),!0===B.hasUVIndices&&X.setAttribute("uv",new t.Float32BufferAttribute(B.uvs,2));for(var T,D=[],Q=0,k=C.length;Q<k;Q++){var q=(W=C[Q]).name+"_"+W.smooth+"_"+R,H=o.materials[q];if(null!==this.materials)if(H=this.materials.create(W.name),!G||!H||H instanceof t.LineBasicMaterial){if(_&&H&&!(H instanceof t.PointsMaterial)){var $=new t.PointsMaterial({size:10,sizeAttenuation:!1});t.Material.prototype.copy.call($,H),$.color.copy(H.color),$.map=H.map,H=$}}else{var J=new t.LineBasicMaterial;t.Material.prototype.copy.call(J,H),J.color.copy(H.color),H=J}void 0===H&&((H=G?new t.LineBasicMaterial:_?new t.PointsMaterial({size:1,sizeAttenuation:!1}):new t.MeshPhongMaterial).name=W.name,H.flatShading=!W.smooth,H.vertexColors=R,o.materials[q]=H),D.push(H)}if(D.length>1){for(Q=0,k=C.length;Q<k;Q++){var W=C[Q];X.addGroup(W.groupStart,W.groupCount,Q)}T=G?new t.LineSegments(X,D):_?new t.Points(X,D):new t.Mesh(X,D)}else T=G?new t.LineSegments(X,D[0]):_?new t.Points(X,D[0]):new t.Mesh(X,D[0]);T.name=P.name,N.add(T)}}else if(o.vertices.length>0){var X;H=new t.PointsMaterial({size:1,sizeAttenuation:!1});(X=new t.BufferGeometry).setAttribute("position",new t.Float32BufferAttribute(o.vertices,3)),o.colors.length>0&&void 0!==o.colors[0]&&(X.setAttribute("color",new t.Float32BufferAttribute(o.colors,3)),H.vertexColors=!0);var Y=new t.Points(X,H);N.add(Y)}return N}}),h}();function r(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function o(t,e,i){return(o=s()?Reflect.construct:function(t,e,i){var r=[null];r.push.apply(r,e);var s=new(Function.bind.apply(t,r));return i&&n(s,i.prototype),s}).apply(null,arguments)}function a(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return l(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}var c=Boolean,u=String,h=String,f=[String,e.Vector3],d=[String,e.Euler],p=[String,e.Quaternion],m=function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.listeners=e?e.listeners:[],this.inst=i||function(){}}var e,i,n;return e=t,(i=[{key:"listen",value:function(t){this.listeners.includes(t)||this.listeners.push(t)}},{key:"unlisten",value:function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}},{key:"emit",value:function(){this.listeners.forEach((function(t){return t()}))}}])&&r(e.prototype,i),n&&r(e,n),t}();function v(t){if(t.isVector3)return t;var i=Array.isArray(t)?t:t.trim().split(/\s+/);return o(e.Vector3,a(i.map(parseFloat)))}function b(t){if(t.isEuler)return t;var i=Array.isArray(t)?t:t.trim().split(/\s+/);return o(e.Euler,a(i.slice(0,3).map(parseFloat)).concat([i[3]]))}function g(t){if(t.isQuaternion)return t;var i=Array.isArray(t)?t:t.trim().split(/\s+/);return o(e.Quaternion,a(i.map(parseFloat)))}function y(t){return!Number.isNaN(parseFloat(t))}function j(t){if(t instanceof e.Vector3)return!0;var i=Array.isArray(t)?t:t.trim().split(/\s+/);return 3===i.length&&i.every(y)}var w={props:{position:{type:f,validator:j},rotation:{type:d,validator:function(t){if(t instanceof e.Euler)return!0;var i=Array.isArray(t)?t:t.trim().split(/\s+/);return 4===i.length&&i.slice(0,3).every(y)&&/[XYZ]{3}/.test(i[3])}},rotationQuaternion:{type:p,validator:function(t){if(t instanceof e.Quaternion)return!0;var i=Array.isArray(t)?t:t.trim().split(/\s+/);return 4===i.length&&i.every(y)}},scale:{type:f,validator:j},castShadow:c,receiveShadow:c,name:{type:h,validator:function(t){return/^\s*\S+\s*$/.test(t)}},hidden:c},inject:{vglObject3d:{default:function(){return new m}},vglNamespace:{default:function(){throw new Error("VueGL components must be wraped by VglNamespace component.")}}},provide:function(){var t=this;return{vglObject3d:new m(this.vglObject3d,(function(){return t.inst}))}},computed:{inst:function(){return new e.Object3D},parent:function(){return this.vglObject3d.inst()}},methods:{emitAsObject3d:function(){this.vglNamespace.object3ds.emit(this.name,this.inst)}},beforeDestroy:function(){this.inst.parent&&this.inst.parent.remove(this.inst),void 0!==this.name&&(this.vglObject3d.unlisten(this.emitAsObject3d),this.vglNamespace.object3ds.delete(this.name,this.inst))},watch:{inst:{handler:function(t,e){e&&e.parent&&e.parent.remove(e),this.parent&&this.parent.add(t),this.position&&t.position.copy(v(this.position)),this.rotation&&t.rotation.copy(b(this.rotation)),this.rotationQuaternion&&t.quaternion.copy(g(this.rotationQuaternion)),this.scale&&t.scale.copy(v(this.scale)),Object.assign(t,{castShadow:this.castShadow,receiveShadow:this.receiveShadow,visible:!this.hidden,name:this.name}),void 0!==this.name&&this.vglNamespace.object3ds.set(this.name,t),e&&this.vglObject3d.emit()},immediate:!0},parent:function(t){t.add(this.inst)},name:[function(t){this.inst.name=t},{handler:function(t,e){void 0!==e&&(this.vglNamespace.object3ds.delete(e,this.inst),void 0===t&&this.vglObject3d.unlisten(this.emitAsObject3d)),void 0!==t&&(this.vglNamespace.object3ds.set(t,this.inst),void 0===e&&this.vglObject3d.listen(this.emitAsObject3d))},immediate:!0}],position:function(t){this.inst.position.copy(v(t)),this.vglObject3d.emit()},rotation:function(t){this.inst.rotation.copy(b(t)),this.vglObject3d.emit()},rotationQuaternion:function(t){this.inst.quaternion.copy(g(t)),this.vglObject3d.emit()},scale:function(t){this.inst.scale.copy(v(t)),this.vglObject3d.emit()},castShadow:function(t){this.inst.castShadow=t,this.vglObject3d.emit()},receiveShadow:function(t){this.inst.receiveShadow=t,this.vglObject3d.emit()},hidden:function(t){this.inst.visible=!t,this.vglObject3d.emit()}},render:function(t){return this.$slots.default?t("template",this.$slots.default):void 0}},x=new i;return{mixins:[w],props:{src:u},data:function(){return{objUuid:null}},computed:{inst:function(){return this.objUuid?this.obj:new e.Object3D}},watch:{src:{handler:function(t){var e=this;x.load(t,(function(t){e.obj=t,e.objUuid=t.uuid}))},immediate:!0}}}}));
