(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?b(exports,require('three')):'function'==typeof define&&define.amd?define(['exports','three'],b):b(a.VueGL={},a.THREE)})(this,function(a,b){'use strict';/**
 * Returns a parsed vector3 object when the argument is a string. Otherwise pass the argument through.
 */function c(a,c){return'string'==typeof a?(c||new b.Vector3).fromArray(a.trim().split(/\s+/).map(function(a){return parseFloat(a)})):c?c.copy(a):a}/**
 * Returns a parsed euler object when the argument is a string. Othewise pass the argument through.
 */function d(a,c){return'string'==typeof a?(c||new b.Euler).fromArray(a.trim().split(/\s+/).map(function(a,b){return 3===b?a:parseFloat(a)})):c?c.copy(a):a}/**
 * Returns a parsed spherical object when the argument is a string. Otherwise pass the argument through.
 */function e(a,c){var d;return'string'==typeof a?(d=c||new b.Spherical).set.apply(d,y(a.trim().split(/\s+/).map(function(a){return parseFloat(a)}))).makeSafe():c?c.copy(a):a}/**
 * Returns a parsed integer number when the argument is a string. Otherwise pass the argument through.
 */function f(a){return'string'==typeof a?parseInt(a,10):a}/**
 * Returns a parsed float number when the argument is a string. Otherwise pass the argument through.
 */function g(a){return'string'==typeof a?parseFloat(a):a}/**
 * Create an object that has array's items as keys. Values are set by setter function.
 */function h(a,b){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{};return a.reduce(function(a,c,d){return a[c]=b(c,d),a},c)}/**
 * Find the nearest ancestor component that has the [key] option.
 */function i(a,b){var c=a.$parent;if(c)return c.$options[b]?c:i(c,b)}/**
 * Constant arrays useful for props validation.
 */function j(){return Object.create(null)}function k(a){return a.$options.isVglRootNamespace}function l(a){return a.slice(0,-1)}function m(a,b){return{props:{name:A},inject:[b],computed:{inst:function(){return new a}},created:function(){this.$set(this[b].forSet,this.name,this.inst)},watch:{inst:function(a){this[b].forSet[this.name]=a}},beforeDestroy:function(){this[b].forSet[this.name]===this.inst&&this.$delete(this[b].forSet,this.name)},render:function(a){if(this.$slots.default)return a('div',this.$slots.default)}}}function n(a,b){var c=a+'_';return{props:x({},a,A),inject:[b],computed:x({},c,function(){return this[b].forGet[this[a]]}),mounted:function(){this[c]&&(this.inst[a]=this[c])},watch:x({},c,function(b){this.inst[a]=b})}}function o(a){var b=[n('material','vglMaterials')];return a&&b.push(n('geometry','vglGeometries')),{mixins:b}}function p(a){return{props:{radius:z,detail:z},computed:{inst:function(){return new a(g(this.radius),f(this.detail))}}}}function q(a,d,f){if(d||f){var g=c(f);if(d){var h=a.inst.position.setFromSpherical(e(d));g&&h.add(g)}a.inst.lookAt(g||new b.Vector3)}}function r(a,b){var c=b.clientWidth,d=b.clientHeight;a.isPerspectiveCamera?a.aspect=c/d:(a.left=c/-2,a.right=c/2,a.top=d/2,a.bottom=d/-2),a.updateProjectionMatrix()}function s(a,b){a.setSize(b.clientWidth,b.clientHeight,!1)}function t(a,b){a.inst.setDirection(c(b).normalize())}var u=function(){function a(a){this.value=a}function b(b){function c(e,f){try{var g=b[e](f),h=g.value;h instanceof a?Promise.resolve(h.value).then(function(a){c('next',a)},function(a){c('throw',a)}):d(g.done?'return':'normal',g.value)}catch(a){d('throw',a)}}function d(a,b){'return'===a?e.resolve({value:b,done:!0}):'throw'===a?e.reject(b):e.resolve({value:b,done:!1});e=e.next,e?c(e.key,e.arg):f=null}var e,f;this._invoke=function(a,b){return new Promise(function(d,g){var h={key:a,arg:b,resolve:d,reject:g,next:null};f?f=f.next=h:(e=f=h,c(a,b))})},'function'!=typeof b.return&&(this.return=void 0)}return'function'==typeof Symbol&&Symbol.asyncIterator&&(b.prototype[Symbol.asyncIterator]=function(){return this}),b.prototype.next=function(a){return this._invoke('next',a)},b.prototype.throw=function(a){return this._invoke('throw',a)},b.prototype.return=function(a){return this._invoke('return',a)},{wrap:function(a){return function(){return new b(a.apply(this,arguments))}},await:function(b){return new a(b)}}}(),v=function(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')},w=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),x=function(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a},y=function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)},z=[String,Number],A=String,B=['vglCameras','vglScenes'],C=['vglGeometries','vglMaterials','vglTextures'],D={isVglNamespace:!0,beforeCreate:function(){var a=this.$options;i(this,'isVglNamespace')||(a.isVglRootNamespace=!0)},provide:function(){var a=this,b=function(){function b(a,c){v(this,b),this.n=a,this.g=c?'':'_'}return w(b,[{key:'forGet',get:function(){return a[this.n+this.g+this.g]}},{key:'forSet',get:function(){return a[this.n+this.g]}}]),b}();return h(C,function(a){return new b(a)},k(this)?h(B,function(a){return new b(a,!0)}):{})},inject:h(C,function(a){return{from:a,default:function(){return{forGet:this[a+'__'],forSet:this[a+'_']}}}}),data:function(){return h(C.map(function(a){return a+'_'}),function(){return j()},k(this)?h(B,function(){return j()}):{})},computed:h(C.map(function(a){return a+'__'}),function(a){return function(){var b=l(a);return k(this)?this[b]:Object.assign(Object.create(this[l(b)].forGet),this[b])}}),render:function(a){if(this.$slots.default)return a('div',this.$slots.default)}},E=new b.Vector3,F=new b.Euler,G=new b.Vector3(1,1,1),H={isVglObject3d:!0,props:{position:{type:[String,b.Vector3],default:function(){return E}},rotation:{type:[String,b.Euler],default:function(){return F}},scale:{type:[String,b.Vector3],default:function(){return G}}},computed:{inst:function(){return new b.Object3D}},created:function(){c(this.position,this.inst.position),d(this.rotation,this.inst.rotation),c(this.scale,this.inst.scale);var a=i(this,'isVglObject3d');a&&a.inst.add(this.inst)},beforeDestroy:function(){this.inst.parent&&this.inst.parent.remove(this.inst)},watch:{position:function(a){c(a||E,this.inst.position)},rotation:function(a){d(a||F,this.inst.rotation)},scale:function(a){c(a||G,this.inst.scale)},inst:function(a,b){b.children.length&&a.add.apply(a,y(b.children)),a.position.copy(b.position),a.rotation.copy(b.rotation),a.scale.copy(b.scale),b.parent&&b.parent.remove(b).add(a)}},render:function(a){if(this.$slots.default)return a('div',this.$slots.default)}},I={mixins:[H,m(b.Scene,'vglScenes')],provide:function(){return{vglLensFlares:this.vglLensFlares}},data:function(){return{vglLensFlares:[]}},computed:{vglLensFlare:function(){if(this.vglLensFlares.length)return this.vglLensFlares.reduce(function(a,b){return a.add.apply(a,y(b.opts)),a},new b.LensFlare)}},watch:{vglLensFlare:function(a,b){a!==b&&(b&&this.inst.remove(b),a&&this.inst.add(a))}}},J={mixins:[H,m(b.Camera,'vglCameras')],props:{orbitTarget:[String,b.Vector3],orbitPosition:[String,b.Spherical]},created:function(){q(this,this.orbitPosition,this.orbitTarget)},watch:{orbitTarget:function(a){q(this,this.orbitPosition,a)},orbitPosition:function(a){q(this,a,this.orbitTarget)}}},K={mixins:[D],props:{precision:String,alpha:Boolean,disablePremultipliedAlpha:Boolean,antialias:Boolean,disableStencil:Boolean,preserveDrawingBuffer:Boolean,disableDepth:Boolean,logarithmicDepthBuffer:Boolean,camera:String,scene:String},beforeCreate:function(){var a=this.$options;a.isVglRootNamespace||(a.inject=h(['vglCameras','vglScenes'],function(a){return{from:a,default:function(){return this[a]}}},a.inject))},provide:function(){return{vglUpdate:this.render}},data:function(){return{key:0,req:!0}},computed:{opt:function(){return{precision:this.precision,alpha:this.alpha,premultipliedAlpha:!this.disablePremultipliedAlpha,antialias:this.antialias,stencil:!this.disableStencil,preserveDrawingBuffer:this.preserveDrawingBuffer,depth:!this.disableDepth,logarithmicDepthBuffer:this.logarithmicDepthBuffer}},inst:function(){return new b.WebGLRenderer(Object.assign({canvas:this.$refs.rdr},this.opt))},cmr:function(){return this.vglCameras[this.camera]},scn:function(){return this.vglScenes[this.scene]}},methods:{resize:function(){s(this.inst,this.$el),this.cmr&&(r(this.cmr,this.$el),this.scn&&this.render())},render:function(){var a=this;this.req&&(this.$nextTick(function(){requestAnimationFrame(function(){a.scn&&a.cmr&&a.inst.render(a.scn,a.cmr),a.req=!0})}),this.req=!1)}},watch:{opt:function(){var a=this;++this.key,this.$nextTick(function(){a.resize()})},scn:function(a){a&&this.render()},cmr:function(a){a&&(r(a,this.$el),this.render())}},updated:function(){this.render()},render:function(a){var b=this;return a('div',[a('canvas',{ref:'rdr',key:this.key},this.$slots.default),a('iframe',{ref:'frm',style:{visibility:'hidden',width:'100%',height:'100%'},on:{load:function(a){a.target.contentWindow.addEventListener('resize',b.resize),b.$nextTick(b.resize)}}})])}},L=[String,Number],M={mixins:[H],props:{color:{type:String,default:'white'},intensity:{type:[String,Number],default:1}},computed:{inst:function(){return new b.Light}},created:function(){this.inst.color.setStyle(this.color),this.inst.intensity=g(this.intensity)},watch:{color:function(a){this.inst.color.setStyle(a)},intensity:function(a){this.inst.intensity=g(a)}}},N={mixins:[m(b.Material,'vglMaterials')]},O={mixins:[N],props:{color:{type:String,default:'#fff'},size:{type:[String,Number],default:1},disableSizeAttenuation:Boolean},computed:{inst:function(){return new b.PointsMaterial}},created:function(){var a=this.inst;a.color.setStyle(this.color),a.size=g(this.size),a.sizeAttenuation=!this.disableSizeAttenuation},watch:{color:function(a){this.inst.color.setStyle(a)},size:function(a){this.inst.size=g(a)},disableSizeAttenuation:function(a){this.inst.sizeAttenuation=!a}}},P={mixins:[m(b.Geometry,'vglGeometries')]},Q=[String,Number],R=['radius','widthSegments','heightSegments','phiStart','phiLength','thetaStart','thetaLength'],S={mixins:[P],props:h(R,function(){return Q}),computed:{inst:function(){var a=this;return new(Function.prototype.bind.apply(b.SphereGeometry,[null].concat(y(R.map(function(b,c){return(1>c||2<c?g:f)(a[b])})))))}}},T={mixins:[H,o(!0)],computed:{inst:function(){return new b.Mesh}}},U={mixins:[H,o(!0)],computed:{inst:function(){return new b.Points}}},V={mixins:[N],props:{color:{type:String,default:'#fff'},lights:Boolean,linewidth:{type:[String,Number],default:1},linecap:{type:String,default:'round'},linejoin:{type:String,default:'round'}},computed:{inst:function(){return new b.LineBasicMaterial}},created:function(){var a=this.inst;a.lights=this.lights,a.linecap=this.linecap,a.linejoin=this.linejoin,a.linewidth=g(this.linewidth),a.color.setStyle(this.color)},watch:{color:function(a){this.inst.color.setStyle(a)},lights:function(a){this.inst.lights=a},linewidth:function(a){this.inst.linewidth=g(a)},linecap:function(a){this.inst.linecap=a},linejoin:function(a){this.inst.linejoin=a}}},W={mixins:[H,o(!0)],computed:{inst:function(){return new b.Line}}},X={mixins:[H,o()],computed:{inst:function(){return new b.Sprite}}},Y=[String,Number],Z=['width','height','depth'],$=['widthSegments','heightSegments','depthSegments'],_={mixins:[P],props:h(Z,function(){return Y},h($,function(){return Y})),computed:{inst:function(){var a=this;return new(Function.prototype.bind.apply(b.BoxGeometry,[null].concat(y(Z.map(function(b){return g(a[b])})),y($.map(function(b){return f(a[b])})))))}}},aa=[String,Number],ba=['radius','segments','thetaStart','thetaLength'],ca={mixins:[P],props:h(ba,function(){return aa}),computed:{inst:function(){var a=this;return new(Function.prototype.bind.apply(b.CircleGeometry,[null].concat(y(ba.map(function(b,c){return(1===c?f:g)(a[b])})))))}}},da={mixins:[W],computed:{inst:function(){return new b.LineSegments}}},ea=[String,Number],fa=['radiusTop','radiusBottom','height','radialSegments','heightSegments','openEnded','thetaStart','thetaLength'],ga={mixins:[P],props:h(fa,function(a,b){return 5===b?Boolean:ea}),computed:{inst:function(){var a=this;return new(Function.prototype.bind.apply(b.CylinderGeometry,[null].concat(y(fa.map(function(b,c){return(3>c||5<c?g:f)(a[b])})))))}}},ha={mixins:[ga],props:{radius:[String,Number]},computed:{inst:function(){var a=this;return new(Function.prototype.bind.apply(b.ConeGeometry,[null].concat(y(['radius','height','radialSegments','heightSegments','openEnded','thetaStart','thetaLength'].map(function(b,c){return(2>c||4<c?g:f)(a[b])})))))}}},ia={mixins:[da],props:{size:[String,Number]},computed:{inst:function(){return new b.AxisHelper(g(this.size))}}},ja=[String,Number],ka=[String,Number],la=['width','height','widthSegments','heightSegments'],ma={mixins:[P],props:h(la,function(){return ka}),computed:{inst:function(){var a=this;return new(Function.prototype.bind.apply(b.PlaneGeometry,[null].concat(y(la.map(function(b,c){return(1<c?f:g)(a[b])})))))}}},na={mixins:[P,p(b.DodecahedronGeometry)]},oa={mixins:[P,p(b.IcosahedronGeometry)]},pa={mixins:[P,p(b.OctahedronGeometry)]},qa=[String,Number],ra=['innerRadius','outerRadius','thetaSegments','phiSegments','thetaStart','thetaLength'],sa={mixins:[P],props:h(ra,function(){return qa}),computed:{inst:function(){var a=this;return new(Function.prototype.bind.apply(b.RingGeometry,[null].concat(y(ra.map(function(b,c){return(2>c||3<c?g:f)(a[b])})))))}}},ta={mixins:[P,p(b.TetrahedronGeometry)]},ua=[String,Number],va=['radius','tube','radialSegments','tubularSegments','arc'],wa={mixins:[P],props:h(va,function(){return ua}),computed:{inst:function(){var a=this;return new(Function.prototype.bind.apply(b.TorusGeometry,[null].concat(y(va.map(function(b,c){return(2>c||3<c?g:f)(a[b])})))))}}},xa=[String,Number],ya=['radius','tube','tubularSegments','radialSegments','p','q'],za={mixins:[P],props:h(ya,function(){return xa}),computed:{inst:function(){var a=this;return new(Function.prototype.bind.apply(b.TorusKnotGeometry,[null].concat(y(ya.map(function(b,c){return(2>c||3<c?g:f)(a[b])})))))}}},Aa=[String,Number],Ba=new b.Vector3(0,1),Ca=new b.Vector3,Da=new b.Color,Ea={mixins:[H],props:{dir:{type:[String,b.Vector3],default:function(){return Ba}},length:{type:Aa,default:1},color:{type:String,default:'#ff0'},headLength:Aa,headWidth:Aa},computed:{inst:function(){return new b.ArrowHelper(Ba,Ca)},len:function(){return[g(this.length),g(this.headLength),g(this.headWidth)]}},created:function(){var a;this.dir!==Ba&&this.inst.setDirection(c(this.dir).normalize()),(a=this.inst).setLength.apply(a,y(this.len)),this.inst.setColor(Da.setStyle(this.color))},watch:{dir:function(a){t(this,a)},len:function(a){var b;(b=this.inst).setLength.apply(b,y(a))},color:function(a){this.inst.setColor(Da.setStyle(a))}}},Fa={mixins:[da],props:{color:{type:String,default:'#ff0'}},data:function(){return{uw:null}},computed:{inst:function(){return new b.BoxHelper}},created:function(){var a=this;this.inst.material.color.setStyle(this.color);var b=i(this,'isVglObject3d');b&&(this.uw=this.$watch(function(){return b.inst},function(b){a.inst.setFromObject(b)},{immediate:!0}))},beforeDestroy:function(){this.uw&&this.uw()},watch:{color:function(a){this.inst.material.color.setStyle(a)}}},Ga=[String,Number],Ha={mixins:[M],props:{distance:{type:z,default:0},decay:{type:z,default:1},angle:{type:z,default:Math.PI/3},penumbra:{type:z,default:0},target:{type:[String,b.Vector3]}},computed:{inst:function(){return new b.SpotLight}},created:function(){var a=this;if(this.inst.distance=g(this.distance),this.inst.decay=g(this.decay),this.inst.angle=g(this.angle),this.inst.penumbra=g(this.penumbra),this.target){c(this.target,this.inst.target.position);var b=i(this,'isVglObject3d');b&&this.$watch(function(){return b.inst},function(b,c){c&&c.remove(a.inst.target),b.add(a.inst.target)},{immediate:!0})}},beforeDestroy:function(){this.inst.target.parent&&this.inst.target.parent.remove(this.inst.target)},watch:{distance:function(a){this.inst.distance=g(a)},decay:function(a){this.inst.decay=g(a)},angle:function(a){this.inst.angle=g(a)},penumbra:function(a){this.inst.penumbra=g(a)},target:function(a){c(a,this.inst.target.position)}}},Ia={props:{texture:A,size:{type:z,default:-1},distance:{type:z,default:0},blending:{type:z,default:b.NormalBlending},color:{type:A,default:'#fff'}},inject:['vglLensFlares'],computed:{opts:function(){return[this.texture,this.size,this.distance,this.blending,new b.Color(this.color)]}},created:function(){this.vglLensFlares.push(this)},beforeDestroy:function(){var a=this.vglLensFlares.indexOf(this);0<=a&&this.vglLensFlares.splice(a,1)},render:function(a){if(this.$slots.default)return a('div',this.$slots.default)}},Ja={mixins:[m(b.Texture,'vglTextures')],inject:['vglUpdate'],props:{src:A},computed:{inst:function(){return this.tex}},data:function(){return{tex:new b.Texture}},created:function(){this.load()},methods:{load:function(){var a=this;new b.TextureLoader().load(this.src,function(b){a.tex=b,a.vglUpdate()})}},watch:{src:function(){this.load()}}};a.VglNamespace=D,a.VglObject3d=H,a.VglScene=I,a.VglCamera=J,a.VglRenderer=K,a.VglPerspectiveCamera={mixins:[J],props:{zoom:{type:L,default:1},near:{type:L,default:0.1},far:{type:L,default:2e3},fov:{type:L,default:50}},computed:{inst:function(){return new b.PerspectiveCamera}},created:function(){var a=this.inst;a.zoom=g(this.zoom),a.near=g(this.near),a.far=g(this.far),a.fov=g(this.fov)},watch:{zoom:function(a){this.inst.zoom=g(a)},near:function(a){this.inst.near=g(a)},far:function(a){this.inst.far=g(a)},fov:function(a){this.inst.fov=g(a)}}},a.VglGroup={mixins:[H],computed:{inst:function(){return new b.Group}}},a.VglLight=M,a.VglDirectionalLight={mixins:[M],computed:{inst:function(){return new b.DirectionalLight}}},a.VglAmbientLight={mixins:[M],computed:{inst:function(){return new b.AmbientLight}}},a.VglMaterial=N,a.VglPointsMaterial=O,a.VglGeometry=P,a.VglSphereGeometry=S,a.VglMeshStandardMaterial={mixins:[N],props:{color:{type:A,default:'#fff'},map:A},inject:['vglTextures'],computed:{inst:function(){return new b.MeshStandardMaterial},tex:function(){return this.map?this.vglTextures.forGet[this.map]:null}},created:function(){this.inst.color.setStyle(this.color),this.inst.map=this.tex},watch:{color:function(a){this.inst.color.setStyle(a)},tex:function(a){this.inst.map=a}}},a.VglMesh=T,a.VglPoints=U,a.VglLineBasicMaterial=V,a.VglLine=W,a.VglSprite=X,a.VglBoxGeometry=_,a.VglCircleGeometry=ca,a.VglLineSegments=da,a.VglLineLoop={mixins:[W],computed:{inst:function(){return new b.LineLoop}}},a.VglConeGeometry=ha,a.VglAxisHelper=ia,a.VglOrthographicCamera={mixins:[J],props:{zoom:{type:ja,default:1},near:{type:ja,default:0.1},far:{type:ja,default:2e3}},computed:{inst:function(){return new b.OrthographicCamera}},created:function(){var a=this.inst;a.zoom=g(this.zoom),a.near=g(this.near),a.far=g(this.far)},watch:{zoom:function(a){this.inst.zoom=g(a)},near:function(a){this.inst.near=g(a)},far:function(a){this.inst.far=g(a)}}},a.VglCylinderGeometry=ga,a.VglPlaneGeometry=ma,a.VglDodecahedronGeometry=na,a.VglIcosahedronGeometry=oa,a.VglOctahedronGeometry=pa,a.VglRingGeometry=sa,a.VglTetrahedronGeometry=ta,a.VglTorusGeometry=wa,a.VglTorusKnotGeometry=za,a.VglArrowHelper=Ea,a.VglBoxHelper=Fa,a.VglPointLight={mixins:[M],props:{distance:{type:Ga,default:0},decay:{type:Ga,default:1}},computed:{inst:function(){return new b.PointLight}},created:function(){this.inst.distance=g(this.distance),this.inst.decay=g(this.decay)},watch:{distance:function(a){this.inst.distance=g(a)},decay:function(a){this.inst.decay=g(a)}}},a.VglSpotLight=Ha,a.VglLensFlare=Ia,a.VglTexture=Ja,Object.defineProperty(a,'__esModule',{value:!0})});
